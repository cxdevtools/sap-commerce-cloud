<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CX Dev Proxy - Portal</title>
    <style>
        :root { --primary: #0056b3; --bg: #f4f7f6; --card-bg: #ffffff; --text: #333; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 2rem; }
        .container { max-width: 900px; margin: 0 auto; }
        h1 { color: var(--primary); text-align: center; margin-bottom: 2rem; }

        .status-banner { background-color: #d4edda; color: #155724; padding: 1rem; border-radius: 8px; margin-bottom: 2rem; text-align: center; display: none; border: 1px solid #c3e6cb; }
        .status-banner strong { font-size: 1.2rem; }

        .section-title { border-bottom: 2px solid #ddd; padding-bottom: 0.5rem; margin-top: 2rem; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem; }

        .card { background: var(--card-bg); padding: 1.5rem; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; border: 1px solid #eee; }
        .card:hover { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0,0,0,0.1); border-color: var(--primary); }
        .card h3 { margin: 0 0 0.5rem 0; color: var(--primary); }
        .card p { margin: 0; color: #666; font-size: 0.9rem; }
        .card.active { border: 2px solid #28a745; background-color: #f8fff9; }

        .links-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .link-btn { display: block; text-align: center; background-color: var(--primary); color: white; text-decoration: none; padding: 1rem; border-radius: 8px; font-weight: bold; transition: background 0.2s; }
        .link-btn:hover { background-color: #004494; }
    </style>
</head>
<body>

<div class="container">
    <h1>üöÄ CX Dev Proxy</h1>

    <div id="active-user-banner" class="status-banner">
        Currently logged in as: <br>
        <strong id="active-user-id">None</strong>
        (<em id="active-user-type">None</em>)
    </div>

    <div id="deeplinks-section" style="display: none;">
        <h2 class="section-title">üîó Application Deep Links</h2>
        <div class="links-grid" id="links-container">
        </div>
    </div>

    <h2 class="section-title">üè¢ Employees (Internal Apps)</h2>
    <div class="grid">
        <div class="card" onclick="setUser('admin', 'employee')" data-id="employee/admin">
            <h3>admin</h3><p>Shop Admin (Full Access)</p>
        </div>
        <div class="card" onclick="setUser('cmsmanager', 'employee')" data-id="employee/cmsmanager">
            <h3>cmsmanager</h3><p>SmartEdit & CMS Access</p>
        </div>
        <div class="card" onclick="setUser('productmanager', 'employee')" data-id="employee/productmanager">
            <h3>productmanager</h3><p>PIM & Backoffice Access</p>
        </div>
    </div>

    <h2 class="section-title">üõçÔ∏è Customers (B2C Storefront)</h2>
    <div class="grid">
        <div class="card" onclick="setUser('visitor@cxdev.me', 'customer')" data-id="customer/visitor@cxdev.me">
            <h3>visitor</h3><p>B2C Visitor</p>
        </div>
        <div class="card" onclick="setUser('customer@cxdev.me', 'customer')" data-id="customer/customer@cxdev.me">
            <h3>customer</h3><p>B2C Customer</p>
        </div>
    </div>

    <h2 class="section-title">üõçÔ∏è Customers (B2B Storefront)</h2>
    <div class="grid">
        <div class="card" onclick="setUser('b2bcustomer@cxdev.me', 'customer')" data-id="customer/b2bcustomer@cxdev.me">
            <h3>b2bcustomer</h3><p>B2B Customer</p>
        </div>
        <div class="card" onclick="setUser('b2bapprover@cxdev.me', 'customer')" data-id="customer/b2bapprover@cxdev.me">
            <h3>b2bapprover</h3><p>B2B Approver</p>
        </div>
        <div class="card" onclick="setUser('b2bmanager@cxdev.me', 'customer')" data-id="customer/b2bmanager@cxdev.me">
            <h3>b2bmanager</h3><p>B2B Manager</p>
        </div>
    </div>
</div>

<script>
    // Utils: Read Cookie
    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
        return null;
    }

    // Action: Set User and Reload
    function setUser(userId, userType) {
        // Expire in 1 day
        const date = new Date();
        date.setTime(date.getTime() + (24*60*60*1000));
        document.cookie = `cxdevproxy_user_id=${userId}; expires=${date.toUTCString()}; path=/`;
        document.cookie = `cxdevproxy_user_type=${userType}; expires=${date.toUTCString()}; path=/`;
        window.location.reload();
    }

    // Init: Check Current State
    window.onload = function() {
        const currentUserId = getCookie('cxdevproxy_user_id');
        const currentUserType = getCookie('cxdevproxy_user_type');

        if (currentUserId) {
            // Show Banner
            const banner = document.getElementById('active-user-banner');
            banner.style.display = 'block';
            document.getElementById('active-user-id').innerText = decodeURIComponent(currentUserId);
            document.getElementById('active-user-type').innerText = decodeURIComponent(currentUserType);

            // Highlight active card
            const activeCard = document.querySelector(`.card[data-id="${currentUserType}/${currentUserId}"]`);
            if(activeCard) activeCard.classList.add('active');

            // Generate Deeplinks dynamically based on current host
            const baseUrl = window.location.protocol + "//" + window.location.host;
            const links = [
                { type: "employee", name: "HAC", path: "/hac/" },
                { type: "employee", name: "Backoffice", path: "/backoffice/" },
                { type: "employee", name: "SmartEdit", path: "/smartedit/" },
                { type: "customer", name: "Storefront", path: "/" }
            ];

            const linksContainer = document.getElementById('links-container');
            links.forEach(link => {
                const a = document.createElement('a');
                a.href = baseUrl + link.path;
                a.className = 'link-btn';
                a.innerText = link.name;
                if (link.type == currentUserType) {
                    linksContainer.appendChild(a);
                }
            });
            document.getElementById('deeplinks-section').style.display = 'block';
        }
    };
</script>
</body>
</html>