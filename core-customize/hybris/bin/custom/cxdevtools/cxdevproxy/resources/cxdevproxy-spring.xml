<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xmlns:util="http://www.springframework.org/schema/util"
	   xsi:schemaLocation="
           http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

	<bean id="cxUndertowProxyManager" class="me.cxdev.commerce.proxy.livecycle.UndertowProxyManager">
		<property name="enabled" value="${cxdevproxy.enabled}" />

		<property name="serverBindAddress" value="${cxdevproxy.server.bindaddress}" />
		<property name="serverProtocol" value="${cxdevproxy.server.protocol}" />
		<property name="serverPort" value="${cxdevproxy.server.port}" />

		<property name="sslEnabled" value="${cxdevproxy.ssl.enabled}" />
		<property name="sslKeystorePath" value="${cxdevproxy.ssl.keystore.path}" />
		<property name="sslKeystorePassword" value="${cxdevproxy.ssl.keystore.password}" />
		<property name="sslKeystoreAlias" value="${cxdevproxy.ssl.keystore.alias}" />

		<property name="frontendProtocol" value="${cxdevproxy.proxy.frontend.protocol}" />
		<property name="frontendHostname" value="${cxdevproxy.proxy.frontend.hostname}" />
		<property name="frontendPort" value="${cxdevproxy.proxy.frontend.port}" />
		<property name="frontendRulesFilePath" value="${cxdevproxy.proxy.frontend.rules}"/>

		<property name="backendProtocol" value="${cxdevproxy.proxy.backend.protocol}" />
		<property name="backendHostname" value="${cxdevproxy.proxy.backend.hostname}" />
		<property name="backendPort" value="${cxdevproxy.proxy.backend.port}" />
		<property name="backendRulesFilePath" value="${cxdevproxy.proxy.backend.rules}"/>
		<property name="backendContexts" value="${cxdevproxy.proxy.backend.contexts}" />

		<property name="routeHandlers" ref="cxRouteHandlers" />
		<property name="groovyRuleEngineService">
			<bean class="me.cxdev.commerce.proxy.livecycle.GroovyRuleEngineService" />
		</property>
		<property name="groovyRuleReloadInterval" value="${cxdevproxy.proxy.rules.reloadinterval}"/>
	</bean>

	<alias alias="cxProxyMessageSource" name="cxDefaultProxyMessageSource" />
	<bean id="cxDefaultProxyMessageSource" class="me.cxdev.commerce.proxy.i18n.ClasspathMergingMessageSource">
		<property name="baseName" value="${cxdevproxy.proxy.ui.messages.basename}" />
		<property name="cacheRefreshIntervalMillis" value="${cxdevproxy.proxy.ui.messages.reloadinterval}"/>
		<property name="useCodeAsDefaultMessage" value="${cxdevproxy.proxy.ui.messages.codeasfallback}"/>
	</bean>

	<alias alias="cxJwtTokenService" name="cxDefaultJwtTokenService" />
	<bean id="cxDefaultJwtTokenService" class="me.cxdev.commerce.jwt.service.CxJwtTokenService">
		<property name="templatePathPrefix" value="${cxdevproxy.proxy.jwt.templatepath}" />
		<property name="tokenValidity" value="${cxdevproxy.proxy.jwt.validity}"/>
		<property name="jwkSource" ref="jwkSource"/>
	</bean>

	<!-- Route Handlers -->
	<alias name="cxDefaultRouteHandlers" alias="cxRouteHandlers"/>
	<util:list id="cxDefaultRouteHandlers" value-type="me.cxdev.commerce.proxy.handler.ProxyRouteHandler">
		<ref bean="cxStartupPageHandler"/>
		<ref bean="cxTemplateRenderingHandler"/>
		<ref bean="cxStaticContentHandler"/>
	</util:list>

	<!-- Proxy Handler and Interceptor -->
	<import resource="classpath:/cxdevproxy/config/cxdevproxy-handler-spring.xml"/>
	<import resource="classpath:/cxdevproxy/config/cxdevproxy-interceptor-spring.xml"/>
	<import resource="classpath:/cxdevproxy/config/cxdevproxy-conditions-spring.xml"/>

	<!-- Additions -->
	<import resource="classpath*:/cxdevproxy/config/cxdevproxy-additions-spring.xml"/>
</beans>